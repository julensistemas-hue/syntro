---
import BaseHead from "../components/BaseHead.astro";
import Analytics from "@vercel/analytics/astro";
import SpeedInsights from "@vercel/speed-insights/astro";

interface Props {
  title: string;
  description?: string;
}

const { title, description = 'Aula Virtual - AI Security' } = Astro.props;
const user = Astro.locals.user;
const paymentPending = Astro.locals.paymentPending;
---

<html lang="es" class="scroll-smooth">
  <head>
    <BaseHead
      title={title}
      description={description}
    />
    <style>
      /* Override global styles for aula */
      body {
        background-color: #0f1419 !important;
        color: #ffffff !important;
      }
      p {
        color: inherit !important;
        max-width: none !important;
      }
      h1, h2, h3, h4, h5, h6 {
        color: inherit !important;
      }
      a {
        color: inherit !important;
      }
    </style>
  </head>
  <body class="min-h-screen" style="background-color: #0f1419;">
    <div class="min-h-screen flex flex-col" style="background-color: #0f1419;">
      <!-- Top Navigation Bar -->
      <header class="sticky top-0 z-50" style="background-color: #1a1f26; border-bottom: 1px solid #2d3748;">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex justify-between items-center h-16">
            <!-- Logo & Brand -->
            <div class="flex items-center gap-4">
              <a href="/" class="flex items-center gap-2">
                <img src="/logo.svg" alt="AI Security" class="h-8 w-auto" />
              </a>
              <span style="color: #6b7280;">|</span>
              <a href="/aula" class="font-semibold hover:opacity-80 transition-colors" style="color: #ffffff;">
                Aula Virtual
              </a>
            </div>

            <!-- User Menu -->
            <div class="flex items-center gap-4">
              {paymentPending && (
                <span class="px-3 py-1 text-sm rounded-full" style="background-color: rgba(245, 158, 11, 0.2); color: #fbbf24; border: 1px solid rgba(245, 158, 11, 0.3);">
                  Pago pendiente
                </span>
              )}
              <div class="flex items-center gap-3">
                <div class="text-right hidden sm:block">
                  <p class="text-sm font-medium" style="color: #ffffff;">{user?.user_metadata?.name || 'Estudiante'}</p>
                  <p class="text-xs" style="color: #9ca3af;">{user?.email}</p>
                </div>
                <div class="h-10 w-10 rounded-full flex items-center justify-center" style="background-color: #0065ff;">
                  <span class="font-semibold" style="color: #ffffff;">
                    {(user?.email?.[0] || 'U').toUpperCase()}
                  </span>
                </div>
              </div>
              <a
                href="/aula/logout"
                class="text-sm transition-colors hover:opacity-80"
                style="color: #9ca3af;"
              >
                Salir
              </a>
            </div>
          </div>
        </div>
      </header>

      <!-- Payment Pending Banner -->
      {paymentPending && (
        <div style="background-color: rgba(245, 158, 11, 0.1); border-bottom: 1px solid rgba(245, 158, 11, 0.2);">
          <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3">
            <div class="flex flex-col sm:flex-row items-center justify-between gap-3">
              <div class="flex items-center gap-2">
                <svg class="w-5 h-5" style="color: #fbbf24;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                </svg>
                <p class="text-sm" style="color: #fde68a;">
                  Tu pago está pendiente de verificación. Una vez confirmado, tendrás acceso completo al curso.
                </p>
              </div>
              <a
                href="/aula/pago"
                class="px-4 py-2 text-sm font-medium rounded-lg transition-colors whitespace-nowrap hover:opacity-90"
                style="background-color: #f59e0b; color: #ffffff;"
              >
                Completar pago
              </a>
            </div>
          </div>
        </div>
      )}

      <!-- Main Content -->
      <main class="flex-1 max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-10 py-8 w-full">
        <slot />
      </main>

      <!-- Aula Footer (simplified) -->
      <footer class="mt-auto" style="background-color: #1a1f26; border-top: 1px solid #2d3748;">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
          <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
            <p class="text-sm" style="color: #6b7280;">
              © {new Date().getFullYear()} AI Security. Todos los derechos reservados.
            </p>
            <div class="flex items-center gap-6">
              <a href="mailto:info@aisecurity.es" class="text-sm transition-colors hover:opacity-80" style="color: #6b7280;">
                Soporte: info@aisecurity.es
              </a>
            </div>
          </div>
        </div>
      </footer>
    </div>
    <Analytics />
    <SpeedInsights />
  </body>
</html>
