---
import BaseHead from "../components/BaseHead.astro";
import Navigation from "../components/global/Navigation.astro";
import Footer from "../components/global/Footer.astro";
import { Font } from "astro:assets";
import Analytics from "@vercel/analytics/astro";
import SpeedInsights from "@vercel/speed-insights/astro";

interface Props {
  title: string;
  description: string;
  publishDate: string;
  author?: string;
  readTime?: string;
  tags?: string[];
  canonical?: string;
  ogImage?: string;
}

const {
  title,
  description,
  publishDate,
  author = "AI Security",
  readTime = "5 min",
  tags = [],
  canonical,
  ogImage = "https://aisecurity.es/og-image.png"
} = Astro.props;

const fullTitle = `${title} | Blog AI Security`;
---

<html
  lang="es"
  class="scroll-smooth selection:bg-accent-500 selection:text-white no-touchevents hydrated">
  <head>
    <BaseHead
      title={fullTitle}
      description={description}
      canonical={canonical}
      ogImage={ogImage}
    />
    <Font cssVariable="--font-sans" preload />
  </head>
  <body class="flex flex-col min-h-svh">
    <Navigation />

    <main class="grow">
      <!-- Article Header -->
      <section class="py-16 relative overflow-hidden border-b border-base-700">
        <!-- Background Image -->
        <div class="absolute inset-0 opacity-30">
          <img src="/images/3409297.jpg" alt="Background" class="w-full h-full object-cover" />
        </div>
        <!-- Overlay Gradient -->
        <div class="absolute inset-0 bg-gradient-to-bl from-accent-600/30 via-blue-600/40 to-accent-600/30"></div>

        <div class="relative z-10 max-w-4xl mx-auto px-6 md:px-8">
          <!-- Breadcrumb -->
          <nav class="mb-6" aria-label="Breadcrumb">
            <ol class="flex items-center gap-2 text-sm text-white/70">
              <li><a href="/" class="hover:text-white transition-colors">Inicio</a></li>
              <li aria-hidden="true">‚Üí</li>
              <li><a href="/blog" class="hover:text-white transition-colors">Blog</a></li>
              <li aria-hidden="true">‚Üí</li>
              <li class="text-white font-medium" aria-current="page">Art√≠culo</li>
            </ol>
          </nav>

          <!-- Tags -->
          {tags.length > 0 && (
            <div  class="flex flex-wrap gap-2 mb-4">
              {tags.map(tag => (
                <span class="px-3 py-1 bg-white/20 backdrop-blur-sm text-white text-xs font-semibold rounded-full border border-white/30">
                  {tag}
                </span>
              ))}
            </div>
          )}

          <!-- Title -->
          <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold text-white mb-4 leading-tight">
            {title}
          </h1>

          <!-- Description -->
          <p class="text-lg md:text-xl text-white/90 mb-6 leading-relaxed">
            {description}
          </p>

          <!-- Meta info -->
          <div  class="flex flex-wrap items-center gap-4 text-sm text-white/80">
            <div class="flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
              </svg>
              <span>{author}</span>
            </div>
            <div class="flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
              </svg>
              <time datetime={publishDate}>{new Date(publishDate).toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric' })}</time>
            </div>
            <div class="flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <span>{readTime} lectura</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Article Content -->
      <article class="py-12 md:py-16 relative overflow-hidden" style="background-color: #010303;">
        <!-- Background Image -->
        <div class="absolute inset-0 opacity-15">
          <img src="/images/3409297.jpg" alt="Background" class="w-full h-full object-cover" />
        </div>

        <div class="relative z-10 max-w-4xl mx-auto px-6 md:px-8">
          <div class="prose prose-lg prose-base max-w-none
            prose-headings:font-bold prose-headings:text-white
            prose-h2:text-2xl prose-h2:mt-8 prose-h2:mb-4 prose-h2:border-b prose-h2:border-base-700 prose-h2:pb-3
            prose-h3:text-xl prose-h3:mt-6 prose-h3:mb-3
            prose-p:text-white/90 prose-p:leading-relaxed prose-p:mb-4
            prose-a:text-accent-400 prose-a:no-underline hover:prose-a:underline
            prose-strong:text-white prose-strong:font-semibold
            prose-code:bg-black prose-code:px-2 prose-code:py-1 prose-code:rounded prose-code:text-sm prose-code:font-mono prose-code:before:content-none prose-code:after:content-none prose-code:border prose-code:border-emerald-500/30
            prose-pre:bg-black prose-pre:rounded-xl prose-pre:border-2 prose-pre:border-blue-500/30 prose-pre:shadow-lg prose-pre:shadow-blue-500/10
            prose-ul:my-4 prose-li:text-white/90 prose-li:my-2
            prose-ol:my-4
            prose-img:rounded-xl prose-img:shadow-lg prose-img:border prose-img:border-base-700">
            <slot />
          </div>
        </div>
      </article>

      <!-- Back to Blog -->
      <section class="py-8 border-t border-base-700 relative overflow-hidden" style="background-color: #121416;">
        <!-- Background Image -->
        <div class="absolute inset-0 opacity-15">
          <img src="/images/3409297.jpg" alt="Background" class="w-full h-full object-cover" />
        </div>

        <div class="relative z-10 max-w-4xl mx-auto px-6 md:px-8">
          <a
            href="/blog"
            class="inline-flex items-center gap-2 text-accent-400 hover:text-accent-300 font-medium transition-colors">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
            </svg>
            Volver al blog
          </a>
        </div>
      </section>
    </main>

    <Footer />
    <Analytics />
    <SpeedInsights />
  </body>
</html>

<script>
  // A√±adir bot√≥n de copiar a cada bloque de c√≥digo y aplicar color
  document.addEventListener('DOMContentLoaded', () => {
    const codeBlocks = document.querySelectorAll('article pre');

    codeBlocks.forEach((block) => {
      // Aplicar color al c√≥digo
      const codeElement = block.querySelector('code');
      if (codeElement) {
        codeElement.style.color = '#64abd3';
      }

      // Crear bot√≥n de copiar
      const copyButton = document.createElement('button');
      copyButton.textContent = 'üìã Copiar c√≥digo';
      copyButton.className = 'copy-button';
      copyButton.setAttribute('aria-label', 'Copiar c√≥digo');

      // A√±adir evento de click
      copyButton.addEventListener('click', async () => {
        const code = block.querySelector('code');
        const text = code?.textContent || '';

        try {
          await navigator.clipboard.writeText(text);
          copyButton.textContent = '‚úì ¬°C√≥digo copiado!';
          copyButton.classList.add('copied');

          // Volver al estado original despu√©s de 2 segundos
          setTimeout(() => {
            copyButton.textContent = 'üìã Copiar c√≥digo';
            copyButton.classList.remove('copied');
          }, 2000);
        } catch (err) {
          console.error('Error al copiar:', err);
        }
      });

      // Insertar el bot√≥n justo despu√©s del bloque de c√≥digo
      block.parentNode?.insertBefore(copyButton, block.nextSibling);
    });

    // Tambi√©n aplicar color al c√≥digo inline
    const inlineCodes = document.querySelectorAll('article :not(pre) > code');
    inlineCodes.forEach((code) => {
      code.style.color = '#64abd3';
    });
  });
</script>

<style>
  /* Mejoras adicionales para el contenido del art√≠culo */
  article img {
    margin: 2rem auto;
  }

  article pre {
    overflow-x: auto;
    padding: 1.5rem; /* Padding uniforme */
  }

  /* Efecto de brillo sutil en los bloques de c√≥digo */
  article pre::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.5), transparent);
  }

  .prose pre code {
    font-size: 0.9em !important;
    background: transparent !important;
    border: none !important;
    padding: 0 !important;
    color: #64abd3 !important;
  }

  /* C√≥digo inline (fuera de pre) */
  .prose :not(pre) > code {
    color: #64abd3 !important;
  }

  article pre code {
    font-size: 0.9em !important;
    background: transparent !important;
    border: none !important;
    padding: 0 !important;
    color: #64abd3 !important;
  }

  /* C√≥digo inline con mejor visibilidad */
  article :not(pre) > code {
    font-weight: 500;
    box-shadow: 0 0 0 1px rgba(16, 185, 129, 0.2);
  }

  /* Mejorar t√≠tulos H2 con gradiente sutil */
  article h2 {
    background: linear-gradient(90deg, rgba(59, 130, 246, 0.1), transparent);
    padding-left: 0.75rem;
    margin-left: -0.75rem;
  }

  /* Listas con mejor espaciado */
  article ul li,
  article ol li {
    padding-left: 0.5rem;
  }

  article ul li::marker {
    color: rgba(59, 130, 246, 0.7);
  }

  /* Bot√≥n de copiar c√≥digo */
  .copy-button {
    padding: 0.625rem 1rem;
    margin-top: -0.5rem;
    margin-bottom: 1.5rem;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 0.5rem;
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.875rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .copy-button:hover {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.3);
    color: rgba(255, 255, 255, 0.9);
    transform: translateX(4px);
  }

  .copy-button:active {
    transform: translateX(2px);
  }

  .copy-button.copied {
    background: rgba(16, 185, 129, 0.1);
    border-color: rgba(16, 185, 129, 0.3);
    color: rgba(16, 185, 129, 0.9);
  }

  .copy-button.copied:hover {
    background: rgba(16, 185, 129, 0.15);
    border-color: rgba(16, 185, 129, 0.4);
  }
</style>
