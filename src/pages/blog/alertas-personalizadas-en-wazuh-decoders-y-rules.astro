---
import BlogLayout from "../../layouts/BlogLayout.astro";
---

<BlogLayout
  title="Alertas personalizadas en Wazuh: Decoders y Rules"
  description="Alertas personalizadas en Wazuh: Decoders y Rules: Guía práctica para implementación empresarial en Wazuh"
  publishDate="2025-12-06"
  author="AI Security"
  readTime="8 min"
  tags={["custom rules", "decoders", "alertas", "logs parsing", "Wazuh", "Ciberseguridad"]}
  canonical="https://aisecurity.es/blog/alertas-personalizadas-en-wazuh-decoders-y-rules">

<div>
<h2>Alertas personalizadas en Wazuh: Potenciando la detección con Decoders y Rules</h2>
<p>Wazuh es una potente plataforma de seguridad, pero su verdadera fuerza se despliega cuando la adaptas a tu entorno específico. Los decoders y las reglas personalizadas son el corazón de esta personalización, permitiéndote transformar logs genéricos en alertas de seguridad accionables. Este artículo te guiará en la creación de estas alertas para cubrir necesidades que las reglas por defecto no abordan.</p>

<h2>Caso de uso empresarial: Detectando accesos SSH desde países no autorizados</h2>
<p>Imagina una empresa cuyos servidores solo deben ser accedidos vía SSH desde su país de operación y, quizás, uno o dos aliados. Cualquier intento de conexión desde una IP geolocalizada en otros países representa una potencial amenaza. Wazuh, con reglas por defecto, alerta del login SSH, pero no discrimina por origen geográfico. Nuestro objetivo es crear una alerta de ALTA prioridad cuando un acceso SSH exitoso provenga de una nación no incluida en nuestra "lista blanca".</p>

<h2>Requisitos previos</h2>
<ul>
<li>Tener Wazuh instalado y funcionando (manager y agente).</li>
<li>Acceso al servidor manager para editar archivos de configuración.</li>
<li>El agente debe estar enviando logs de autenticación SSH (generalmente /var/log/auth.log o /var/log/secure).</li>
<li>Wazuh configurado con la funcionalidad de Geolocalización de IP activa.</li>
</ul>

<h2>Instalación paso a paso: Creando la regla personalizada</h2>
<p>Todo el trabajo se realiza en el servidor manager de Wazuh. Las reglas y decoders personalizados se ubican en el directorio /var/ossec/etc para evitar que se sobrescriban en actualizaciones.</p>
<pre><code class="language-bash"># 1. Navegar al directorio de reglas personalizadas
cd /var/ossec/etc

# 2. Crear o editar el archivo de decoders personalizados (si no existe)
sudo nano decoders/local_decoder.xml

# 3. Crear o editar el archivo de reglas personalizadas
sudo nano rules/local_rules.xml

# 4. Tras guardar los cambios, reiniciar el manager de Wazuh
sudo systemctl restart wazuh-manager

# 5. Verificar que no hay errores en los logs
sudo tail -f /var/ossec/logs/ossec.log</code></pre>

<h2>Ejemplo práctico: Regla para bloque de países en SSH</h2>
<p>Vamos a crear una regla que se active ante un acceso SSH exitoso desde fuera de España, Alemania o Francia. Asumimos que Wazuh ya decodifica los logs SSH y añade el campo `location.country`. Nuestra regla evaluará ese campo.</p>
<p><strong>Contenido del archivo local_rules.xml:</strong></p>
<pre><code class="language-xml">&lt;group name="ssh,local,"&gt;
  &lt;rule id="100100" level="10"&gt;
    &lt;if_sid&gt;5716&lt;/if_sid&gt;
    &lt;options&gt;no_full_log&lt;/options&gt;
    &lt;description>SSH login: Detected from a non-allowed country.&lt;/description&gt;
    &lt;group>authentication_success,pci_dss_10.2.5,&lt;/group&gt;
    &lt;list field="location.country" lookup="not_in"&gt;ES,DE,FR&lt;/list&gt;
  &lt;/rule&gt;
&lt;/group&gt;</code></pre>
<p><strong>Explicación del código:</strong></p>
<ul>
<li><strong>&lt;rule id="100100"&gt;</strong>: Usamos un ID alto (&gt;100000) para reglas personalizadas.</li>
<li><strong>&lt;if_sid&gt;5716&lt;/if_sid&gt;</strong>: Esta regla se ejecuta tras la regla nativa 5716 (SSH login successful).</li>
<li><strong>&lt;list field="location.country" lookup="not_in"&gt;ES,DE,FR&lt;/list&gt;</strong>: El núcleo de la regla. Activa la alerta si el campo `location.country` del evento NO está en la lista de países permitidos (España, Alemania, Francia).</li>
<li><strong>level="10"</strong>: Asigna un nivel de alerta alto (crítico es 12, error 10 es importante).</li>
</ul>
<p>Una vez reiniciado el manager, cualquier inicio de sesión SSH exitoso desde, por ejemplo, Estados Unidos o China, generará una alerta clara en el dashboard, permitiendo una investigación inmediata.</p>

<h2>Conclusión</h2>
<p>Dominar la creación de decoders y reglas personalizadas en Wazuh te convierte de un usuario en un arquitecto de tu propia detección de amenazas. Puedes adaptar la plataforma para monitorizar comportamientos específicos de tu red, aplicaciones internas o cumplimiento de políticas de seguridad. Comienza con casos simples como el expuesto y expande tu cobertura gradualmente. ¿Necesitas ayuda para diseñar reglas personalizadas para tu infraestructura? <a href="/reunion">Solicita una consulta gratuita</a> con nuestros expertos en Wazuh y ciberseguridad.</p>
</div>

  <hr />

  <p class="text-sm text-base-600">
    <strong>¿Necesitas implementar esta solución?</strong> <a href="/reunion">Solicita una consulta gratuita aquí</a>.
  </p>
</BlogLayout>
