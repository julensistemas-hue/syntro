---
import BaseLayout from "../../layouts/BaseLayout.astro";
---

<BaseLayout>
  <section class="py-10 bg-base-25">
    <div class="max-w-7xl mx-auto px-8 md:px-12 lg:px-24">
      <!-- Hero Section -->
      <div class="text-center mb-16">
   
        <h1 class="text-4xl md:text-5xl font-bold text-base-900 mb-6">
          Recepcionista virtual <span class="text-accent-600">que nunca descansa</span>
        </h1>
      
      </div>

      <!-- Interactive Demo Section -->
      <div class="mb-16">
        <div class="max-w-4xl mx-auto bg-gradient-to-br from-base-900 to-base-800 rounded-2xl shadow-2xl overflow-hidden">
          <!-- Demo Header -->
          <div class="bg-base-800 px-6 py-4 border-b border-base-700">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <div class="w-3 h-3 rounded-full bg-red-500"></div>
                <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                <div class="w-3 h-3 rounded-full bg-green-500"></div>
                <span class="ml-4 text-base-300 text-sm font-medium">Atenci√≥n Telef√≥nica - Demo</span>
              </div>
              <div class="flex items-center gap-2 text-base-400 text-sm">
                <span class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></span>
                Disponible 24/7
              </div>
            </div>
          </div>

          <!-- Phone Interface -->
          <div class="bg-gradient-to-br from-blue-500 to-blue-700 p-8">
            <div class="grid lg:grid-cols-2 gap-8 max-w-6xl mx-auto items-start">
              <!-- Phone Mockup -->
              <div class="relative bg-gradient-to-b from-gray-900 via-gray-800 to-gray-900 rounded-[3rem] p-3 shadow-2xl border-8 border-gray-800 w-full max-w-md mx-auto lg:mx-0 h-[750px]">
                <!-- Phone screen -->
                <div class="bg-black rounded-[2.5rem] overflow-hidden h-full flex flex-col">
                  <!-- Status bar -->
                  <div class="flex items-center justify-between text-white text-xs px-6 py-3 bg-black flex-shrink-0">
                    <span class="font-semibold">9:41</span>
                    <div class="flex gap-1.5 items-center">
                      <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"></path>
                      </svg>
                      <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M17.778 8.222c-4.296-4.296-11.26-4.296-15.556 0A1 1 0 01.808 6.808c5.076-5.077 13.308-5.077 18.384 0a1 1 0 01-1.414 1.414zM14.95 11.05a7 7 0 00-9.9 0 1 1 0 01-1.414-1.414 9 9 0 0112.728 0 1 1 0 01-1.414 1.414zM12.12 13.88a3 3 0 00-4.242 0 1 1 0 01-1.415-1.415 5 5 0 017.072 0 1 1 0 01-1.415 1.415zM9 16a1 1 0 011-1h.01a1 1 0 110 2H10a1 1 0 01-1-1z" clip-rule="evenodd"></path>
                      </svg>
                      <span class="text-[10px]">100%</span>
                    </div>
                  </div>

                  <!-- Main content area -->
                  <div class="bg-gradient-to-b from-gray-900 to-black flex-1 px-6 py-8 flex flex-col overflow-hidden relative">
                    <!-- Pre-Call Screen (shown before call) -->
                    <div id="pre-call-screen" class="absolute inset-0 px-6 py-8 flex flex-col">
                      <!-- Contact photo and info -->
                      <div class="text-center mb-8">
                        <div class="w-32 h-32 mx-auto mb-4 rounded-full bg-gradient-to-br from-blue-500 to-blue-700 flex items-center justify-center text-white text-5xl font-bold shadow-2xl">
                          DG
                        </div>
                        <h3 class="text-white text-2xl font-semibold mb-2">Cl√≠nica Dental<br/>Dr. Garc√≠a</h3>
                        <p class="text-gray-400 text-base">+34 900 123 456</p>
                        <p id="call-status" class="text-gray-500 text-sm mt-2"></p>
                      </div>

                      <!-- Scenario Selector -->
                      <div class="mb-auto">
                        <p class="text-gray-400 text-xs font-semibold mb-3 text-center uppercase tracking-wide">Motivo de la llamada</p>
                        <div class="space-y-2">
                          <button data-scenario="reservar" class="scenario-button w-full text-left px-4 py-3 bg-gray-800/50 backdrop-blur rounded-xl border border-blue-500/50 hover:bg-gray-700/50 transition-all duration-200 text-sm text-white shadow-lg shadow-blue-500/20">
                            <div class="flex items-center gap-3">
                              <span class="text-xl">üìÖ</span>
                              <span>Reservar una cita</span>
                            </div>
                          </button>
                          <button data-scenario="modificar" class="scenario-button w-full text-left px-4 py-3 bg-gray-800/30 backdrop-blur rounded-xl border border-gray-700 hover:bg-gray-700/50 transition-all duration-200 text-sm text-white">
                            <div class="flex items-center gap-3">
                              <span class="text-xl">‚úèÔ∏è</span>
                              <span>Modificar/Eliminar cita</span>
                            </div>
                          </button>
                          <button data-scenario="pago" class="scenario-button w-full text-left px-4 py-3 bg-gray-800/30 backdrop-blur rounded-xl border border-gray-700 hover:bg-gray-700/50 transition-all duration-200 text-sm text-white">
                            <div class="flex items-center gap-3">
                              <span class="text-xl">üí≥</span>
                              <span>Consulta sobre pago</span>
                            </div>
                          </button>
                        </div>
                      </div>

                      <!-- Call Button -->
                      <div class="flex justify-center mt-auto pt-8">
                        <button id="call-button" class="flex flex-col items-center gap-2 cursor-pointer hover:opacity-80 transition-opacity">
                          <div class="w-20 h-20 rounded-full bg-green-500 hover:bg-green-600 flex items-center justify-center shadow-2xl shadow-green-500/50 hover:scale-105 transition-transform">
                            <svg class="w-10 h-10 text-white" fill="currentColor" viewBox="0 0 20 20">
                              <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"></path>
                            </svg>
                          </div>
                          <span class="text-white text-xs"></span>
                        </button>
                      </div>
                    </div>

                    <!-- In-Call Screen (shown during call) -->
                    <div id="in-call-screen" class="hidden absolute inset-0 px-6 py-8 flex-col justify-between">
                      <!-- Contact photo and info (smaller) -->
                      <div class="text-center pt-8">
                        <div class="w-24 h-24 mx-auto mb-4 rounded-full bg-gradient-to-br from-blue-500 to-blue-700 flex items-center justify-center text-white text-4xl font-bold shadow-2xl">
                          DG
                        </div>
                        <h3 class="text-white text-xl font-semibold mb-1">Cl√≠nica Dental Dr. Garc√≠a</h3>
                        <p class="text-green-400 text-sm font-medium">En llamada</p>
                      </div>

                      <!-- Call Duration -->
                      <div class="text-center flex-1 flex flex-col justify-center">
                        <div class="text-white text-5xl font-light mb-2" id="duration-text">00:00</div>
                        <p class="text-gray-400 text-sm">Duraci√≥n de la llamada</p>
                      </div>

                      <!-- Hang Up Button -->
                      <div class="flex justify-center pb-8">
                        <button id="hangup-button-in-phone" class="flex flex-col items-center gap-2 cursor-pointer hover:opacity-80 transition-opacity">
                          <div class="w-20 h-20 rounded-full bg-red-500 hover:bg-red-600 flex items-center justify-center shadow-2xl shadow-red-500/50 hover:scale-105 transition-transform">
                            <svg class="w-10 h-10 text-white transform rotate-135" fill="currentColor" viewBox="0 0 20 20">
                              <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"></path>
                            </svg>
                          </div>
                          <span class="text-white text-xs">Colgar</span>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Transcription Panel (always visible) -->
              <div id="transcription-panel" class="bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl p-6 w-full max-w-md mx-auto lg:mx-0 h-[750px] flex flex-col">
                <div class="flex items-center justify-between mb-4 pb-4 border-b border-gray-200 flex-shrink-0">
                  <h4 style="color: #4f46e5;" class="text-lg font-semibold text-gray-900 flex items-center gap-2">
                    <svg class="w-5 h-5 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path>
                    </svg>
                    Transcripci√≥n en vivo
                  </h4>
                  <div id="recording-indicator" class="hidden items-center gap-2">
                    <span class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></span>
                    <span class="text-xs text-gray-500 font-medium">Grabando</span>
                  </div>
                </div>

                <div id="conversation-log" class="space-y-3 flex-1 overflow-y-auto pr-2">
                  <!-- Empty state -->
                  <div id="empty-state" class="flex flex-col items-center justify-center h-full text-center py-12">
                    <svg class="w-16 h-16 text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                    </svg>
                    <p style="color: black;" class="text-gray-400 text-sm font-medium">La transcripci√≥n aparecer√° aqu√≠</p>
                    <p style="color: black;" class="text-gray-300 text-xs mt-2">Selecciona un motivo y pulsa "Llamar"</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Info Panel -->
          <div class="bg-base-100 px-6 py-5">
            <p class="text-sm text-base-600 text-center font-medium max-w-2xl mx-auto">
              Esta es una demo simulada. El sistema real utiliza s√≠ntesis de voz natural y procesamiento de lenguaje avanzado.
            </p>
          </div>
        </div>
      </div>
 
        <p class="text-xl text-base-600 max-w-3xl mx-auto mb-8">
          Atenci√≥n telef√≥nica automatizada con voz natural. Gestiona llamadas, reserva citas,
          responde preguntas frecuentes y deriva casos complejos a tu equipo.
        </p>
          <!-- Features Grid
        <div class="inline-flex items-center gap-2 px-4 py-2 bg-green-50 text-green-700 rounded-lg text-sm font-medium">
          <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
          Demo interactiva disponible abajo
        </div>-->
      <!-- Features Grid -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-16">
        <div class="bg-black border-2 border-base-300 rounded-xl p-6">
          <div class="w-12 h-12 bg-accent-600 rounded-lg flex items-center justify-center text-white text-xl mb-4">
            üó£Ô∏è
          </div>
          <h3 class="text-lg font-semibold text-white mb-3">Voz Natural</h3>
          <p class="text-white/80">
            S√≠ntesis de voz con entonaci√≥n natural y pronunciaci√≥n perfecta en espa√±ol.
          </p>
        </div>

        <div class="bg-black border-2 border-base-300 rounded-xl p-6">
          <div class="w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center text-white text-xl mb-4">
            üéØ
          </div>
          <h3 class="text-lg font-semibold text-white mb-3">Comprensi√≥n Contextual</h3>
          <p class="text-white/80">
            Entiende el contexto de la conversaci√≥n y adapta las respuestas.
          </p>
        </div>

        <div class="bg-black border-2 border-base-300 rounded-xl p-6">
          <div class="w-12 h-12 bg-green-600 rounded-lg flex items-center justify-center text-white text-xl mb-4">
            üîÄ
          </div>
          <h3 class="text-lg font-semibold text-white mb-3">Derivaci√≥n Inteligente</h3>
          <p class="text-white/80">
            Transfiere llamadas complejas a agentes humanos cuando es necesario.
          </p>
        </div>
      </div>

      <!-- Stats Section -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-16">
        <div class="rounded-xl p-6 text-white text-center" style="background: linear-gradient(to bottom right, #4338ca, #3730a3);">
          <div class="text-4xl font-bold mb-2">24/7</div>
          <div class="text-sm opacity-90">Disponibilidad</div>
        </div>
        <div class="rounded-xl p-6 text-white text-center" style="background: linear-gradient(to bottom right, #6366f1, #4f46e5);">
          <div class="text-4xl font-bold mb-2">90%</div>
          <div class="text-sm opacity-90">Llamadas resueltas</div>
        </div>
        <div class="rounded-xl p-6 text-white text-center" style="background: linear-gradient(to bottom right, #3b82f6, #2563eb);">
          <div class="text-4xl font-bold mb-2">70%</div>
          <div class="text-sm opacity-90">Reducci√≥n de costos</div>
        </div>
        <div class="rounded-xl p-6 text-white text-center"style="background: linear-gradient(to bottom right, #78ceff, #3b82f6);  ">
          <div class="text-4xl font-bold mb-2">0s</div>
          <div class="text-sm opacity-90">Tiempo de espera</div>
        </div>
      </div>

      <!-- CTA Section -->
      <div class="text-center rounded-2xl p-12 text-white">
        <h2 class="text-3xl font-bold mb-4">
          Nunca pierdas una llamada importante
        </h2>
        <p class="text-xl mb-8 max-w-2xl mx-auto opacity-90">
          Descubre c√≥mo nuestra IA puede transformar tu atenci√≥n telef√≥nica
        </p>
        <a
          href="/reunion"
          style="color: white;"
          class="inline-flex items-center justify-center px-8 py-4 text-lg font-semibold text-white bg-blue-600 hover:bg-blue-700 rounded-xl shadow-lg hover:shadow-xl transition-all duration-200"
        >
          Solicitar Demo Gratuita
        </a>
      </div>
    </div>
  </section>
</BaseLayout>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const callButton = document.getElementById('call-button');
    const callButtonContainer = document.getElementById('call-button-container');
    const hangupButtonInPhone = document.getElementById('hangup-button-in-phone');
    const durationText = document.getElementById('duration-text');
    const conversationLog = document.getElementById('conversation-log');
    const scenarioButtons = document.querySelectorAll('.scenario-button');
    const scenarioSelectorContainer = document.getElementById('scenario-selector-container');
    const preCallScreen = document.getElementById('pre-call-screen');
    const inCallScreen = document.getElementById('in-call-screen');
    const transcriptionPanel = document.getElementById('transcription-panel');
    const recordingIndicator = document.getElementById('recording-indicator');
    const emptyState = document.getElementById('empty-state');

    let isInCall = false;
    let callStartTime = 0;
    let durationInterval: number;
    let currentAudio: HTMLAudioElement | null = null;
    let audioTimeouts: number[] = [];
    let selectedScenario: keyof typeof scenarios = 'reservar';

    // Escenarios con sus conversaciones y archivos de audio
    const scenarios = {
      reservar: [
        { delay: 1000, speaker: 'AI', text: '¬°Hola! Bienvenido a Cl√≠nica Dental Dr. Garc√≠a. ¬øEn qu√© puedo ayudarte?', audio: '/audio/reservar/ai_1.mp3' },
        { delay: 3000, speaker: 'User', text: 'Hola, quisiera reservar una cita', audio: '/audio/reservar/user_1.mp3' },
        { delay: 4500, speaker: 'AI', text: 'Por supuesto. ¬øQu√© d√≠a te vendr√≠a mejor?', audio: '/audio/reservar/ai_2.mp3' },
        { delay: 6000, speaker: 'User', text: 'El pr√≥ximo martes por la ma√±ana', audio: '/audio/reservar/user_2.mp3' },
        { delay: 7500, speaker: 'AI', text: 'Perfecto. Tengo disponibilidad a las 10:00 y a las 11:30. ¬øCu√°l prefieres?', audio: '/audio/reservar/ai_3.mp3' },
        { delay: 9000, speaker: 'User', text: 'A las 10:00 est√° bien', audio: '/audio/reservar/user_3.mp3' },
        { delay: 10500, speaker: 'AI', text: '¬°Excelente! He reservado tu cita para el martes a las 10:00. Te enviar√© un SMS de confirmaci√≥n. ¬øNecesitas algo m√°s?', audio: '/audio/reservar/ai_4.mp3' },
      ],
      modificar: [
        { delay: 1000, speaker: 'AI', text: 'Buenos d√≠as, Cl√≠nica Dental Dr. Garc√≠a. ¬øEn qu√© puedo ayudarle?', audio: '/audio/modificar/ai_1.mp3' },
        { delay: 3000, speaker: 'User', text: 'Necesito modificar mi cita del jueves', audio: '/audio/modificar/user_1.mp3' },
        { delay: 4500, speaker: 'AI', text: 'Claro, d√©jame verificar. ¬øPodr√≠a darme su nombre completo?', audio: '/audio/modificar/ai_2.mp3' },
        { delay: 6000, speaker: 'User', text: 'Soy Mar√≠a Gonz√°lez', audio: '/audio/modificar/user_2.mp3' },
        { delay: 7500, speaker: 'AI', text: 'Perfecto, Mar√≠a. Veo que tiene una cita el jueves a las 16:00. ¬øQu√© d√≠a le vendr√≠a mejor?', audio: '/audio/modificar/ai_3.mp3' },
        { delay: 9500, speaker: 'User', text: 'El viernes por la tarde', audio: '/audio/modificar/user_3.mp3' },
        { delay: 11000, speaker: 'AI', text: 'Tengo disponibilidad el viernes a las 17:30. ¬øLe viene bien?', audio: '/audio/modificar/ai_4.mp3' },
        { delay: 12500, speaker: 'User', text: 'S√≠, perfecto', audio: '/audio/modificar/user_4.mp3' },
        { delay: 13500, speaker: 'AI', text: 'Listo, he modificado su cita al viernes 17:30. Le enviar√© una confirmaci√≥n por SMS.', audio: '/audio/modificar/ai_5.mp3' },
      ],
      pago: [
        { delay: 1000, speaker: 'AI', text: 'Cl√≠nica Dental Dr. Garc√≠a, ¬øen qu√© puedo ayudarle?', audio: '/audio/pago/ai_1.mp3' },
        { delay: 3000, speaker: 'User', text: 'Quisiera saber cu√°nto dura un tratamiento de ortodoncia', audio: '/audio/pago/user_1.mp3' },
        { delay: 5000, speaker: 'AI', text: 'El tratamiento de ortodoncia suele durar entre 12 y 24 meses, dependiendo del caso. ¬øLe gustar√≠a informaci√≥n sobre las formas de pago?', audio: '/audio/pago/ai_2.mp3' },
        { delay: 7500, speaker: 'User', text: 'S√≠, ¬øtienen opciones de financiaci√≥n?', audio: '/audio/pago/user_2.mp3' },
        { delay: 9000, speaker: 'AI', text: 'S√≠, ofrecemos financiaci√≥n sin intereses hasta 12 meses, y tambi√©n aceptamos tarjetas de cr√©dito y transferencias. ¬øLe gustar√≠a agendar una consulta gratuita para valoraci√≥n?', audio: '/audio/pago/ai_3.mp3' },
        { delay: 11500, speaker: 'User', text: 'S√≠, me interesa', audio: '/audio/pago/user_3.mp3' },
        { delay: 12500, speaker: 'AI', text: 'Perfecto. ¬øQu√© d√≠a le vendr√≠a mejor para la consulta?', audio: '/audio/pago/ai_4.mp3' },
      ]
    };

    function addConversationLine(speaker: string, text: string, audioSrc?: string) {
      if (!conversationLog) return;

      // Ocultar estado vac√≠o en el primer mensaje
      if (emptyState && !emptyState.classList.contains('hidden')) {
        emptyState.classList.add('hidden');
      }

      const line = document.createElement('div');
      line.className = speaker === 'AI'
        ? 'flex gap-2 items-start'
        : 'flex gap-2 items-start justify-end';

      const bubble = document.createElement('div');
      bubble.className = speaker === 'AI'
        ? 'bg-blue-50 text-gray-800 px-4 py-2 rounded-2xl rounded-tl-sm max-w-[85%]'
        : 'bg-blue-600 text-white px-4 py-2 rounded-2xl rounded-tr-sm max-w-[85%]';

      const content = document.createElement('div');
      const label = document.createElement('div');
      label.className = 'text-xs font-semibold mb-1 opacity-70';
      label.textContent = speaker === 'AI' ? 'ü§ñ Asistente' : 'üë§ T√∫';

      const message = document.createElement('div');
      message.className = 'text-sm leading-relaxed';
      message.textContent = text;

      content.appendChild(label);
      content.appendChild(message);
      bubble.appendChild(content);
      line.appendChild(bubble);

      conversationLog.appendChild(line);
      conversationLog.scrollTop = conversationLog.scrollHeight;

      // Reproducir audio si est√° disponible
      if (audioSrc) {
        playAudio(audioSrc);
      }
    }

    function playAudio(src: string) {
      // Detener audio actual si existe
      if (currentAudio) {
        currentAudio.pause();
        currentAudio.currentTime = 0;
      }

      // Crear y reproducir nuevo audio
      currentAudio = new Audio(src);
      currentAudio.play().catch(error => {
        console.log('Audio playback failed:', error);
        // Silenciosamente fallar si el audio no est√° disponible
      });
    }

    function stopAllAudio() {
      if (currentAudio) {
        currentAudio.pause();
        currentAudio.currentTime = 0;
        currentAudio = null;
      }

      // Limpiar todos los timeouts de audio
      audioTimeouts.forEach(timeout => clearTimeout(timeout));
      audioTimeouts = [];
    }

    function updateDuration() {
      const elapsed = Math.floor((Date.now() - callStartTime) / 1000);
      const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
      const seconds = (elapsed % 60).toString().padStart(2, '0');
      if (durationText) {
        durationText.textContent = `${minutes}:${seconds}`;
      }
    }

    function startCall() {
      isInCall = true;
      callStartTime = Date.now();

      // Usar escenario seleccionado
      const conversation = scenarios[selectedScenario];

      // Ocultar pantalla pre-llamada
      if (preCallScreen) preCallScreen.classList.add('hidden');

      // Mostrar pantalla en llamada
      if (inCallScreen) {
        inCallScreen.classList.remove('hidden');
        inCallScreen.classList.add('flex');
      }

      // Mostrar indicador de grabaci√≥n
      if (recordingIndicator) {
        recordingIndicator.classList.remove('hidden');
        recordingIndicator.classList.add('flex');
      }

      // Start duration counter
      durationInterval = setInterval(updateDuration, 1000) as unknown as number;

      // Play conversation with audio
      conversation.forEach(line => {
        const timeout = setTimeout(() => {
          if (isInCall) {
            addConversationLine(line.speaker, line.text, line.audio);
          }
        }, line.delay) as unknown as number;
        audioTimeouts.push(timeout);
      });
    }

    function endCall() {
      isInCall = false;
      clearInterval(durationInterval);
      stopAllAudio();

      // Ocultar pantalla en llamada
      if (inCallScreen) {
        inCallScreen.classList.add('hidden');
        inCallScreen.classList.remove('flex');
      }

      // Ocultar indicador de grabaci√≥n
      if (recordingIndicator) {
        recordingIndicator.classList.add('hidden');
        recordingIndicator.classList.remove('flex');
      }

      // Limpiar transcripci√≥n y mostrar estado vac√≠o
      if (conversationLog) {
        conversationLog.innerHTML = `
          <div id="empty-state" class="flex flex-col items-center justify-center h-full text-center py-12">
            <svg class="w-16 h-16 text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
            </svg>
            <p class="text-gray-400 text-sm font-medium">La transcripci√≥n aparecer√° aqu√≠</p>
            <p class="text-gray-300 text-xs mt-2">Selecciona un motivo y pulsa "Llamar"</p>
          </div>
        `;
      }

      // Reset temporizador
      if (durationText) durationText.textContent = '00:00';

      // Mostrar pantalla pre-llamada
      if (preCallScreen) preCallScreen.classList.remove('hidden');
    }

    // Funci√≥n para actualizar el escenario seleccionado
    function updateSelectedScenario(scenario: keyof typeof scenarios) {
      selectedScenario = scenario;

      // Actualizar estilos de los botones
      scenarioButtons.forEach(btn => {
        const btnScenario = btn.getAttribute('data-scenario');
        if (btnScenario === scenario) {
          btn.classList.remove('border-gray-700', 'bg-gray-800/30');
          btn.classList.add('border-blue-500/50', 'bg-gray-800/50', 'shadow-lg', 'shadow-blue-500/20');
        } else {
          btn.classList.remove('border-blue-500/50', 'bg-gray-800/50', 'shadow-lg', 'shadow-blue-500/20');
          btn.classList.add('border-gray-700', 'bg-gray-800/30');
        }
      });
    }

    // Event listener para el bot√≥n de llamar
    if (callButton) {
      callButton.addEventListener('click', startCall);
    }

    // Event listeners para los botones de escenario
    scenarioButtons.forEach(button => {
      button.addEventListener('click', () => {
        const scenario = button.getAttribute('data-scenario') as keyof typeof scenarios;
        if (scenario) {
          updateSelectedScenario(scenario);
        }
      });
    });

    // Event listener para colgar (bot√≥n dentro del tel√©fono)
    if (hangupButtonInPhone) {
      hangupButtonInPhone.addEventListener('click', endCall);
    }
  });
</script>
